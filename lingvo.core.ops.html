

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>lingvo.core.ops package &mdash; Lingvo  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="lingvo.core.ops.hyps_pb2 module" href="lingvo.core.ops.hyps_pb2.html" />
    <link rel="prev" title="lingvo.core package" href="lingvo.core.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Lingvo
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="lingvo.html">lingvo package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="lingvo.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="lingvo.core.html">lingvo.core package</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="lingvo.core.html#subpackages">Subpackages</a></li>
<li class="toctree-l4"><a class="reference internal" href="lingvo.core.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tasks.html">lingvo.tasks package</a></li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tools.html">lingvo.tools package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="lingvo.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Lingvo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="lingvo.html">lingvo package</a> &raquo;</li>
        
          <li><a href="lingvo.core.html">lingvo.core package</a> &raquo;</li>
        
      <li>lingvo.core.ops package</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/lingvo.core.ops.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-lingvo.core.ops">
<span id="lingvo-core-ops-package"></span><h1>lingvo.core.ops package<a class="headerlink" href="#module-lingvo.core.ops" title="Permalink to this headline">¶</a></h1>
<p>Operations.</p>
<dl class="py function">
<dt id="lingvo.core.ops.assert_shape_match">
<code class="sig-prename descclassname">lingvo.core.ops.</code><code class="sig-name descname">assert_shape_match</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">y</span></em>, <em class="sig-param"><span class="n">msg</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.ops.assert_shape_match" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts that shape vector x and y matches.</p>
<p>The i-th dimension matches iff x[i] == y[i] || x[i] == -1 || y[i] == -1.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>. A shape vector.</p></li>
<li><p><strong>y</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>. A shape vector.</p></li>
<li><p><strong>msg</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>.
The error message generated when the assertion failed.</p></li>
<li><p><strong>name</strong> – A name for the operation (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The created Operation.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.ops.assert_same_dim0">
<code class="sig-prename descclassname">lingvo.core.ops.</code><code class="sig-name descname">assert_same_dim0</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">msg</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.ops.assert_same_dim0" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts that all input tensors are non-scalar and have the same 0-th dim size.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – A list of <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> objects. The list of tensors.</p></li>
<li><p><strong>msg</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>.
The error message generated when the assertion failed.</p></li>
<li><p><strong>name</strong> – A name for the operation (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The created Operation.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.ops.random_permutation_sequence">
<code class="sig-prename descclassname">lingvo.core.ops.</code><code class="sig-name descname">random_permutation_sequence</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">num</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">batch</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">repeat</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.ops.random_permutation_sequence" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate random samples from [0..num-1] without replacements.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>num</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">1</span></code>. The number of ids.</p></li>
<li><p><strong>batch</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">1</span></code>.
Each output is a vector of size up to batch. Right now,
the last batch from one epoch is the only one that can be
smaller than a full batch.</p></li>
<li><p><strong>repeat</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a>. Defaults to <a class="reference external" href="https://docs.python.org/3.7/library/constants.html#False" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a>.
If true, this op keep generating random samples after one
epoch. If false, this op errors with <code class="xref py py-obj docutils literal notranslate"><span class="pre">tf.errors.OutOfRangeError</span></code> when an
epoch finishes.</p></li>
<li><p><strong>seed</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">0</span></code>. The random seed.</p></li>
<li><p><strong>name</strong> – A name for the operation (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>. Each output is a vector of size up to batch.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.ops.best_step">
<code class="sig-prename descclassname">lingvo.core.ops.</code><code class="sig-name descname">best_step</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hist_file</span></em>, <em class="sig-param"><span class="n">tol</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">minimize</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">metric</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.ops.best_step" title="Permalink to this definition">¶</a></dt>
<dd><p>Determines the best global step from a history file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hist_file</strong> – A <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>.
A text file containing ‘step score’ records, or a file pattern that
matches tf event files in the format of /path_to_file/events.out.tfevents*.</p></li>
<li><p><strong>tol</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#float" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">0</span></code>.
Difference between previous best score and current score must be greater
than this amount to trigger update.</p></li>
<li><p><strong>minimize</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a>. Defaults to <a class="reference external" href="https://docs.python.org/3.7/library/constants.html#True" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>.
If the metric is being minimized. Recorded in hist_file, smaller
scores are better if True, and bigger scores are better if False.</p></li>
<li><p><strong>metric</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>.
The name of the metric being tracked.</p></li>
<li><p><strong>name</strong> – A name for the operation (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int64</span></code>.
Shape [2]. best_step[0] is scalar value for best global step.
best_step[1] is scalar value for last global step.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.ops.beam_search_step">
<code class="sig-prename descclassname">lingvo.core.ops.</code><code class="sig-name descname">beam_search_step</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">scores</span></em>, <em class="sig-param"><span class="n">atten_probs</span></em>, <em class="sig-param"><span class="n">best_scores</span></em>, <em class="sig-param"><span class="n">cumulative_scores</span></em>, <em class="sig-param"><span class="n">in_scores</span></em>, <em class="sig-param"><span class="n">in_hyps</span></em>, <em class="sig-param"><span class="n">in_prev_hyps</span></em>, <em class="sig-param"><span class="n">in_done_hyps</span></em>, <em class="sig-param"><span class="n">in_atten_probs</span></em>, <em class="sig-param"><span class="n">is_last_chunk</span></em>, <em class="sig-param"><span class="n">cur_step</span></em>, <em class="sig-param"><span class="n">eos_id</span></em>, <em class="sig-param"><span class="n">beam_size</span></em>, <em class="sig-param"><span class="n">num_hyps_per_beam</span></em>, <em class="sig-param"><span class="n">eoc_id</span><span class="o">=</span><span class="default_value">- 1</span></em>, <em class="sig-param"><span class="n">valid_eos_max_logit_delta</span><span class="o">=</span><span class="default_value">5</span></em>, <em class="sig-param"><span class="n">local_eos_threshold</span><span class="o">=</span><span class="default_value">- 100</span></em>, <em class="sig-param"><span class="n">merge_paths</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">allow_empty_terminated_hyp</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">ensure_full_beam</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">force_eos_in_last_step</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.ops.beam_search_step" title="Permalink to this definition">¶</a></dt>
<dd><p>Move forward one step in beam search.</p>
<p>Let “b” be the number of beams, “k” be the number hyps in each beam, “t” be the
maximum decoding steps.</p>
<p>The following data structures are allocated before the first decoding step and
are passed along from cur step to the next step:</p>
<dl class="simple">
<dt>in_scores</dt><dd><p>A tensor of shape [t, b * k]. in_scores[i, j] is the local
score of the j-th hyp at the i-th decoding step.</p>
</dd>
<dt>in_hyps</dt><dd><p>A tensor of shape [t, b * k]. in_hyps[i, j] is the token id of the
j-th hyp at the i-th decoding step.</p>
</dd>
<dt>in_prev_hyps</dt><dd><p>A tensor of shape [t, b * k]. in_prev_hyps[i, j] stores a
pointer of the j-th hyp at time step i to the hyp at previous timestep
(i - 1). 0 &lt;= in_prev_hyps[i, j] &lt; b * k.</p>
</dd>
<dt>in_done_hyps</dt><dd><p>A tensor of shape [t, b * k]. in_done_hyps[i, j] can be either an
empty string, or a serialized Hypothesis proto. Terminated hyps are removed
from the beam and are moved to the corresponding in_done_hyps slot.</p>
</dd>
<dt>in_atten_probs</dt><dd><p>A tensor of shape [t, b * k, s_len]. in_atten_probs[i, j, …]
is the attention probs over the source words for the j-th hyp at the i-th
timestep.</p>
</dd>
</dl>
<p>Those tensors are modified (with content for the cur_step timestep being filled
in) within this op invocation and are passed to the corresponding output
tensors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>scores</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">float32</span></code>.
A matrix of shape [b * k, vocab_size], where b is the number of
active beams, and k is the number of hyps in each beam. Local scores for the
current timestep.</p></li>
<li><p><strong>atten_probs</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">float32</span></code>.
A matrix of shape [b * k, source_len]. Attention probabilities
for the current timestep.</p></li>
<li><p><strong>best_scores</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">float32</span></code>.
A vector of size [b], best scores of terminated hyps so far in
each of the beams.</p></li>
<li><p><strong>cumulative_scores</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">float32</span></code>.
A vector of size [b * k]. The cumulative score of each
active hyp before the current step.</p></li>
<li><p><strong>in_scores</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">float32</span></code>. As explained above.</p></li>
<li><p><strong>in_hyps</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>. As explained above.</p></li>
<li><p><strong>in_prev_hyps</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>. As explained above.</p></li>
<li><p><strong>in_done_hyps</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>. As explained above.</p></li>
<li><p><strong>in_atten_probs</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">float32</span></code>. As explained above.</p></li>
<li><p><strong>is_last_chunk</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a>.
A tensor of shape [b * k]. Used by neural transducer, determine
whether the current hypothesis reaches the last chunk and should treat the
next end-of-chunk symbol as end-of-sentence.</p></li>
<li><p><strong>cur_step</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>. Current step id.</p></li>
<li><p><strong>eos_id</strong> – An <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>. Token id of the special end of sequence token.</p></li>
<li><p><strong>beam_size</strong> – A <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#float" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a>.
Search terminates if the delta between the scores of the active hyps
in a beam and the best scores exceeds this threashold.</p></li>
<li><p><strong>num_hyps_per_beam</strong> – An <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>. Number of hyps in a beam.</p></li>
<li><p><strong>eoc_id</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">-1</span></code>.
Token id of the special end of chunk token.</p></li>
<li><p><strong>valid_eos_max_logit_delta</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#float" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">5</span></code>.
We allow &lt;/s&gt; to terminate a hyp only if its logit
is no more than <code class="xref py py-obj docutils literal notranslate"><span class="pre">valid_eos_max_logit_delta</span></code> away from the logit of the best
candidate.</p></li>
<li><p><strong>local_eos_threshold</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#float" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">-100</span></code>.
We allow &lt;/s&gt; to terminate a hyp if the local score for
&lt;/s&gt; is greater than local_eos_threshold.</p></li>
<li><p><strong>merge_paths</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a>. Defaults to <a class="reference external" href="https://docs.python.org/3.7/library/constants.html#False" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a>.
If true, hyps which are identical when epsilons are removed will
be combined into a single hyp.  The probability for that combined hyp will
be the sum of the probabilities of the component hyps.  This can only be
applied for epsilon-emitting models (RNN-T and NT).</p></li>
<li><p><strong>allow_empty_terminated_hyp</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a>. Defaults to <a class="reference external" href="https://docs.python.org/3.7/library/constants.html#True" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>.
Whether it is okay to consider a hyp that consists
only of epsilons as terminated.  By default this is true, as an
utterance may consist of silence.  It should be set to false when EMBR
training epsilon-emitting models (e.g., RNN-T), which are prone to emit
all-epsilon hyps even in the absence of silence.  Note that a hyp that
terminates in EOS is not considered empty, so this flag has no effect for
non-epsilon-emitting models.</p></li>
<li><p><strong>ensure_full_beam</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a>. Defaults to <a class="reference external" href="https://docs.python.org/3.7/library/constants.html#False" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a>.
If True, we will not set the all_done output to True until we
have found ‘num_hyps_per_beam’ terminated hyps AND no active hyps have a
score within ‘beam_size’ of the best terminated hyp.  If False, only the
second condition must be satisfied.  Generally this should be False unless
beam search is being run as part of minimum word error rate training.</p></li>
<li><p><strong>force_eos_in_last_step</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a>. Defaults to <a class="reference external" href="https://docs.python.org/3.7/library/constants.html#False" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a>.
If true, then if decode does not terminate even after
(max - 1) steps, eos symbol is injected into the result and partial
hypotheses (with a valid eos symbol in the end) are returned. all_done
is set to true for these partials. If false, which is the default behavior,
empty hypothesis are returned and all_done is set to false at termination.</p></li>
<li><p><strong>name</strong> – A name for the operation (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>A tuple of <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> objects (out_best_scores, out_cumulative_scores, out_scores, out_hyps, out_prev_hyps, out_done_hyps, out_atten_probs, all_done).</p>
<dl class="simple">
<dt>out_best_scores: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">float32</span></code>.</dt><dd><p>Updated best scores for each of the beams.</p>
</dd>
<dt>out_cumulative_scores: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">float32</span></code>.</dt><dd><p>A vector of size [b * k]. The cumulative score of the new hyps after the
current decoding step.</p>
</dd>
<dt>out_scores: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">float32</span></code>.</dt><dd><p>As explained above.</p>
</dd>
<dt>out_hyps: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.</dt><dd><p>As explained above.</p>
</dd>
<dt>out_prev_hyps: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.</dt><dd><p>As explained above.</p>
</dd>
<dt>out_done_hyps: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>.</dt><dd><p>As explained above.</p>
</dd>
<dt>out_atten_probs: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">float32</span></code>.</dt><dd><p>As explained above.</p>
</dd>
<dt>all_done: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a>.</dt><dd><p>A scalar, whether decoding should terminate for all beams.</p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.ops.top_k_terminated_hyps">
<code class="sig-prename descclassname">lingvo.core.ops.</code><code class="sig-name descname">top_k_terminated_hyps</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">in_done_hyps</span></em>, <em class="sig-param"><span class="n">src_seq_lengths</span></em>, <em class="sig-param"><span class="n">k</span></em>, <em class="sig-param"><span class="n">num_hyps_per_beam</span></em>, <em class="sig-param"><span class="n">length_normalization</span></em>, <em class="sig-param"><span class="n">coverage_penalty</span></em>, <em class="sig-param"><span class="n">target_seq_length_ratio</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">eoc_id</span><span class="o">=</span><span class="default_value">- 1</span></em>, <em class="sig-param"><span class="n">merge_paths</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.ops.top_k_terminated_hyps" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the top k terminated hyps based on normalized score for each beam.</p>
<p>Let “b” be the number of beams, “h” be the number hyps in each beam, “t” be the
maximum decoding steps.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>in_done_hyps</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>.
A tensor of shape [t, h * b]. Each string in in_done_hyps can be
either an empty string, or a serialized Hypothesis proto. If not empty,
in_done_hyps[t, i * num_beams + j] represents the i-th hypothesis for beam
j that terminates at step t.</p></li>
<li><p><strong>src_seq_lengths</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.
A tensor of shape [b] of the src sequence lengths.</p></li>
<li><p><strong>k</strong> – An <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>. number of highest scoring hyps to be returned for each beam.</p></li>
<li><p><strong>num_hyps_per_beam</strong> – An <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>.
Number of hyps per beam in the input <code class="xref py py-obj docutils literal notranslate"><span class="pre">in_done_hyps</span></code>.</p></li>
<li><p><strong>length_normalization</strong> – A <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#float" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a>. The length normalization ratio.</p></li>
<li><p><strong>coverage_penalty</strong> – A <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#float" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a>. The alpha value for coverage penalty.</p></li>
<li><p><strong>target_seq_length_ratio</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#float" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">1</span></code>.
Ratio of the average target sequence length
over the average source sequence length.</p></li>
<li><p><strong>eoc_id</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">-1</span></code>.
Token id of the special end of chunk or blank (epsilon) token. -1 means
this model does not use epsilon.</p></li>
<li><p><strong>merge_paths</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a>. Defaults to <a class="reference external" href="https://docs.python.org/3.7/library/constants.html#False" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a>.
If true, hyps which are identical when epsilons are removed will
be combined into a single hyp. The probability for that combined hyp will
be the sum of the probabilities of the component hyps. This can only be
applied for epsilon-emitting models (RNN-T and NT).</p></li>
<li><p><strong>name</strong> – A name for the operation (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>.
A string tensor of shape [b, k]. topk_hyps[i: ] contains
top k terminated hyp for beam ‘i’, each hyp could be either an empty string
or a serialized <code class="xref py py-obj docutils literal notranslate"><span class="pre">Hypothesis</span></code> proto.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.ops.unpack_hyp">
<code class="sig-prename descclassname">lingvo.core.ops.</code><code class="sig-name descname">unpack_hyp</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">in_hyps</span></em>, <em class="sig-param"><span class="n">max_seq_length</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.ops.unpack_hyp" title="Permalink to this definition">¶</a></dt>
<dd><p>Unpacks hyps into tensors of ids, seq_len and scores.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>in_hyps</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>.
A vector of serialized <code class="xref py py-obj docutils literal notranslate"><span class="pre">Hypothesis</span></code> protos.</p></li>
<li><p><strong>max_seq_length</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">0</span></code>.</p></li>
<li><p><strong>name</strong> – A name for the operation (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>A tuple of <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> objects (out_ids, out_seq_lens, out_scores).</p>
<dl class="simple">
<dt>out_ids: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.</dt><dd><p>Output sequences, a matrix of shape (batch_size, max_seq_length).
Sequences shorter than max_seq_length are padded with 0s. If max_seq_length is 0, derive it from the longest sequence in input_hyps.</p>
</dd>
<dt>out_seq_lens: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.</dt><dd><p>Length of each of the output sequence, a vector of size <code class="xref py py-obj docutils literal notranslate"><span class="pre">batch_size</span></code>.</p>
</dd>
<dt>out_scores: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">float32</span></code>.</dt><dd><p>Scores for each of the output sequence, a vector of <code class="xref py py-obj docutils literal notranslate"><span class="pre">batch_size</span></code>.</p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.ops.hyps_from_beam_search_outs">
<code class="sig-prename descclassname">lingvo.core.ops.</code><code class="sig-name descname">hyps_from_beam_search_outs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hyps</span></em>, <em class="sig-param"><span class="n">prev_hyps</span></em>, <em class="sig-param"><span class="n">done_hyps</span></em>, <em class="sig-param"><span class="n">scores</span></em>, <em class="sig-param"><span class="n">atten_probs</span></em>, <em class="sig-param"><span class="n">eos_scores</span></em>, <em class="sig-param"><span class="n">eos_atten_probs</span></em>, <em class="sig-param"><span class="n">eos_id</span></em>, <em class="sig-param"><span class="n">num_hyps_per_beam</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.ops.hyps_from_beam_search_outs" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates <code class="xref py py-obj docutils literal notranslate"><span class="pre">Hypothesis</span></code> protos from output of a beam search step.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hyps</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.
A tensor of shape [t, b * k] with ids of the token selected.</p></li>
<li><p><strong>prev_hyps</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.
A tensor of shape [t, b * k] with index to the previous hyps which
was selected.</p></li>
<li><p><strong>done_hyps</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a>.
A boolean tensor of shape [t, b * k] where value indicates if hyps
was terminated.</p></li>
<li><p><strong>scores</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code>. Must be one of the following types: <code class="xref py py-obj docutils literal notranslate"><span class="pre">float32</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">bfloat16</span></code>.
A tensor of shape [t, b * k]. in_scores[i, j] is the local score of
the j-th hyp at the i-th decoding step.</p></li>
<li><p><strong>atten_probs</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code>. Must have the same type as <code class="xref py py-obj docutils literal notranslate"><span class="pre">scores</span></code>.
A tensor of shape [t, b * k, s_len]. atten_probs[i, j, …]
is the attention probs over the source words for the j-th hyp at the i-th
timestep.</p></li>
<li><p><strong>eos_scores</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code>. Must have the same type as <code class="xref py py-obj docutils literal notranslate"><span class="pre">scores</span></code>.
A tensor of shape [t, b * k]. eos_scores[i, j] is the local
score of the EOS token at the j-th hyp at the i-th decoding step.</p></li>
<li><p><strong>eos_atten_probs</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code>. Must have the same type as <code class="xref py py-obj docutils literal notranslate"><span class="pre">scores</span></code>.
A tensor of shape [t, b * k, s_len].
eos_atten_probs[i, j, …] is the attention probs over the source words
for the j-th terminated hyp at the i-th timestep.</p></li>
<li><p><strong>eos_id</strong> – An <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>. Token id of the special end of sequence token.</p></li>
<li><p><strong>num_hyps_per_beam</strong> – An <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>. Number of hyps per beam.</p></li>
<li><p><strong>name</strong> – A name for the operation (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>.
A tensor of shape [t, b * k] with terminated hyps.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.ops.cached_call">
<code class="sig-prename descclassname">lingvo.core.ops.</code><code class="sig-name descname">cached_call</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">f</span></em>, <em class="sig-param"><span class="n">T</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.ops.cached_call" title="Permalink to this definition">¶</a></dt>
<dd><p>Invokes function f once and memorize its output.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>f</strong> – A function decorated with &#64;Defun.
A function that returns a list of tensors (T).</p></li>
<li><p><strong>T</strong> – A list of <code class="xref py py-obj docutils literal notranslate"><span class="pre">tf.DTypes</span></code>.</p></li>
<li><p><strong>name</strong> – A name for the operation (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list of <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> objects of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">T</span></code>.
A list of output tensors whose types are T.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.ops.vocab_token_to_id">
<code class="sig-prename descclassname">lingvo.core.ops.</code><code class="sig-name descname">vocab_token_to_id</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">token</span></em>, <em class="sig-param"><span class="n">vocab</span></em>, <em class="sig-param"><span class="n">load_token_ids_from_vocab</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.ops.vocab_token_to_id" title="Permalink to this definition">¶</a></dt>
<dd><p>Looks up the token in the vocab and return its id.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>token</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>. A scalar or list of strings.</p></li>
<li><p><strong>vocab</strong> – A list of <code class="xref py py-obj docutils literal notranslate"><span class="pre">strings</span></code>. A list of strings.</p></li>
<li><p><strong>load_token_ids_from_vocab</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a>. Defaults to <a class="reference external" href="https://docs.python.org/3.7/library/constants.html#False" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a>.
Whether token ids are present in vocab (i.e. vocab
contains two colums, one for IDs and one for words).  If false, line numbers
are used.</p></li>
<li><p><strong>name</strong> – A name for the operation (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>. A scalar or list of ints.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.ops.vocab_id_to_token">
<code class="sig-prename descclassname">lingvo.core.ops.</code><code class="sig-name descname">vocab_id_to_token</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">id</span></em>, <em class="sig-param"><span class="n">vocab</span></em>, <em class="sig-param"><span class="n">load_token_ids_from_vocab</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.ops.vocab_id_to_token" title="Permalink to this definition">¶</a></dt>
<dd><p>Looks up the token at the given id from a vocab.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>id</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>. A scalar or list of ints.</p></li>
<li><p><strong>vocab</strong> – A list of <code class="xref py py-obj docutils literal notranslate"><span class="pre">strings</span></code>. A list of strings.</p></li>
<li><p><strong>load_token_ids_from_vocab</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a>. Defaults to <a class="reference external" href="https://docs.python.org/3.7/library/constants.html#False" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a>.
Whether token ids are present in vocab (i.e. vocab
contains two colums, one for IDs and one for words).  If false, line numbers
are used.</p></li>
<li><p><strong>name</strong> – A name for the operation (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>. A scalar or list of strings.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.ops.token_in_vocab">
<code class="sig-prename descclassname">lingvo.core.ops.</code><code class="sig-name descname">token_in_vocab</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">token</span></em>, <em class="sig-param"><span class="n">vocab</span></em>, <em class="sig-param"><span class="n">load_token_ids_from_vocab</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.ops.token_in_vocab" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks whether the provided token is in the vocab.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>token</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>. A scalar or list of strings.</p></li>
<li><p><strong>vocab</strong> – A list of <code class="xref py py-obj docutils literal notranslate"><span class="pre">strings</span></code>. A list of strings.</p></li>
<li><p><strong>load_token_ids_from_vocab</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a>. Defaults to <a class="reference external" href="https://docs.python.org/3.7/library/constants.html#False" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a>.
Whether token ids are present in vocab (i.e. vocab
contains two colums, one for IDs and one for words).  If false, line numbers
are used.</p></li>
<li><p><strong>name</strong> – A name for the operation (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a>. A scalar or list of bools.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.ops.ascii_to_token_id">
<code class="sig-prename descclassname">lingvo.core.ops.</code><code class="sig-name descname">ascii_to_token_id</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">labels</span></em>, <em class="sig-param"><span class="n">append_eos</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">maxlen</span><span class="o">=</span><span class="default_value">300</span></em>, <em class="sig-param"><span class="n">pad_to_maxlen</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.ops.ascii_to_token_id" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts ASCII label strings into token ids.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>labels</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>. A vector of shape [batch].</p></li>
<li><p><strong>append_eos</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a>. Defaults to <a class="reference external" href="https://docs.python.org/3.7/library/constants.html#True" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>.
Whether to append &lt;/s&gt; at the end and treat it as a non-padded
label.</p></li>
<li><p><strong>maxlen</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">300</span></code>.
an integer, sequence length of the output tensors.</p></li>
<li><p><strong>pad_to_maxlen</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a>. Defaults to <a class="reference external" href="https://docs.python.org/3.7/library/constants.html#True" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>.
Whether to pad the output to maxlen.</p></li>
<li><p><strong>name</strong> – A name for the operation (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>A tuple of <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> objects (token_ids, target_ids, paddings).</p>
<dl class="simple">
<dt>token_ids: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.</dt><dd><p>A matrix of shape [batch, maxlen].
token_ids[i, j] is the i-th sample’s j-th token id.
token_ids[i, 0] is always &lt;s&gt;.</p>
</dd>
<dt>target_ids: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.</dt><dd><p>A matrix of shape [batch, maxlen].
target_ids[i, j] is the i-th sample’s j-th prediction label id.</p>
</dd>
<dt>paddings: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">float32</span></code>.</dt><dd><p>A matrix of shape [batch, maxlen].
paddings[i, j] == 1.0 indicates that i-th training example’
j-th target token is padded and should be ignored.</p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.ops.str_to_vocab_tokens">
<code class="sig-prename descclassname">lingvo.core.ops.</code><code class="sig-name descname">str_to_vocab_tokens</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">labels</span></em>, <em class="sig-param"><span class="n">vocab_filepath</span></em>, <em class="sig-param"><span class="n">append_eos</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">maxlen</span><span class="o">=</span><span class="default_value">300</span></em>, <em class="sig-param"><span class="n">pad_to_maxlen</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">load_token_ids_from_vocab</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">delimiter</span><span class="o">=</span><span class="default_value">' '</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.ops.str_to_vocab_tokens" title="Permalink to this definition">¶</a></dt>
<dd><p>Tokenizes string into white space separated tokens according to a vocab file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>labels</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>. A vector of shape [batch].</p></li>
<li><p><strong>vocab_filepath</strong> – A <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>. a string, filepath to the vocab file.</p></li>
<li><p><strong>append_eos</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a>. Defaults to <a class="reference external" href="https://docs.python.org/3.7/library/constants.html#True" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>.
Whether to append &lt;/s&gt; at the end and treat it as a non-padded
label.</p></li>
<li><p><strong>maxlen</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">300</span></code>.
an integer, sequence length of the output tensors.</p></li>
<li><p><strong>pad_to_maxlen</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a>. Defaults to <a class="reference external" href="https://docs.python.org/3.7/library/constants.html#True" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>.
Whether to pad the output to maxlen.</p></li>
<li><p><strong>load_token_ids_from_vocab</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a>. Defaults to <a class="reference external" href="https://docs.python.org/3.7/library/constants.html#True" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>.
Whether token ids are present in vocab (i.e. vocab
contains two colums, one for IDs and one for words).  If false, line numbers
are used.</p></li>
<li><p><strong>delimiter</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">&quot;</span> <span class="pre">&quot;</span></code>.
The delimiter to split the labels to tokens by.</p></li>
<li><p><strong>name</strong> – A name for the operation (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>A tuple of <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> objects (token_ids, target_ids, paddings).</p>
<dl class="simple">
<dt>token_ids: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.</dt><dd><p>A matrix of shape [batch, maxlen].
token_ids[i, j] is the i-th sample’s j-th token id.
token_ids[i, 0] is always &lt;s&gt;.</p>
</dd>
<dt>target_ids: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.</dt><dd><p>A matrix of shape [batch, maxlen].
target_ids[i, j] is the i-th sample’s j-th prediction label id.</p>
</dd>
<dt>paddings: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">float32</span></code>.</dt><dd><p>A matrix of shape [batch, maxlen].
paddings[i, j] == 1.0 indicates that i-th training example’s
j-th target token is padded and should be ignored.</p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.ops.id_to_ascii">
<code class="sig-prename descclassname">lingvo.core.ops.</code><code class="sig-name descname">id_to_ascii</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">token_ids</span></em>, <em class="sig-param"><span class="n">seq_lengths</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.ops.id_to_ascii" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts sequences from token ids to actual ASCII tokens.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>token_ids</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>. A matrix of shape [batch, seq_len].</p></li>
<li><p><strong>seq_lengths</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.
A vector of shape [batch]. seq_lengths[i] is the length of the
i-th sequence. Only the first seq_lengths[i] tokens in token_ids[i] are
valid tokens for the i-th sequence.</p></li>
<li><p><strong>name</strong> – A name for the operation (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>.
A vector of shape [batch]. The converted string sequence.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.ops.ml_perf_subword_id_to_string">
<code class="sig-prename descclassname">lingvo.core.ops.</code><code class="sig-name descname">ml_perf_subword_id_to_string</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">token_ids</span></em>, <em class="sig-param"><span class="n">seq_lengths</span></em>, <em class="sig-param"><span class="n">vocab_filepath</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.ops.ml_perf_subword_id_to_string" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts sequences from subword token ids to strings</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>token_ids</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>. A matrix of shape [batch, seq_len].</p></li>
<li><p><strong>seq_lengths</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.
A vector of shape [batch]. seq_lengths[i] is the length of the
i-th sequence. Only the first seq_lengths[i] tokens in token_ids[i] are
valid tokens for the i-th sequence.</p></li>
<li><p><strong>vocab_filepath</strong> – A <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>. filepath to the MLPerf subword vocab file.</p></li>
<li><p><strong>name</strong> – A name for the operation (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>.
A vector of shape [batch]. The converted string sequence.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.ops.ngram_id_to_token">
<code class="sig-prename descclassname">lingvo.core.ops.</code><code class="sig-name descname">ngram_id_to_token</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">token_ids</span></em>, <em class="sig-param"><span class="n">seq_lengths</span></em>, <em class="sig-param"><span class="n">ngram_vocab_filepath</span></em>, <em class="sig-param"><span class="n">ngram_separator</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.ops.ngram_id_to_token" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts sequences from token ids to actual tokens.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>token_ids</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>. A matrix of shape [batch, seq_len].</p></li>
<li><p><strong>seq_lengths</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.
A vector of shape [batch]. seq_lengths[i] is the length of the
i-th sequence. Only the first seq_lengths[i] tokens in token_ids[i] are
valid tokens for the i-th sequence.</p></li>
<li><p><strong>ngram_vocab_filepath</strong> – A <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>. filepath to the ngram vocab file.</p></li>
<li><p><strong>ngram_separator</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>.
separator to use when joining ngrams into string.</p></li>
<li><p><strong>name</strong> – A name for the operation (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>.
A vector of shape [batch]. The converted string sequence.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.ops.bpe_ids_to_words">
<code class="sig-prename descclassname">lingvo.core.ops.</code><code class="sig-name descname">bpe_ids_to_words</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">token_ids</span></em>, <em class="sig-param"><span class="n">seq_lengths</span></em>, <em class="sig-param"><span class="n">vocab_filepath</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.ops.bpe_ids_to_words" title="Permalink to this definition">¶</a></dt>
<dd><p>A tokenizer to map BPE ids to strings.</p>
<p>This op is to map a sequence of integer ids to a string. The op is typically
used in conjunction with BpeWordsToIds.</p>
<p>The op will consume <code class="xref py py-obj docutils literal notranslate"><span class="pre">seq_lengths</span></code> of tokens from <code class="xref py py-obj docutils literal notranslate"><span class="pre">token_ids</span></code> and convert it to
string <code class="xref py py-obj docutils literal notranslate"><span class="pre">sequences</span></code>. A space character will be interested inbetween tokens. We do
not filter any tokens (i.e., &lt;s&gt; and &lt;/s&gt; are not treated specially).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>token_ids</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.
The ids (can include paddings; length is determined by seq_lengths). The shape is [batch_size, maxlen].</p></li>
<li><p><strong>seq_lengths</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.
The length of the ids. The shape is [batch_size].</p></li>
<li><p><strong>vocab_filepath</strong> – A <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>.
A path to a text file where each line is a BPE string token.</p></li>
<li><p><strong>name</strong> – A name for the operation (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>.
The string sequences. The shape is [batch_size].</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.ops.bpe_words_to_ids">
<code class="sig-prename descclassname">lingvo.core.ops.</code><code class="sig-name descname">bpe_words_to_ids</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">labels</span></em>, <em class="sig-param"><span class="n">tokenization_filepath</span></em>, <em class="sig-param"><span class="n">append_eos</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">maxlen</span><span class="o">=</span><span class="default_value">300</span></em>, <em class="sig-param"><span class="n">sos_id</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">eos_id</span><span class="o">=</span><span class="default_value">2</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.ops.bpe_words_to_ids" title="Permalink to this definition">¶</a></dt>
<dd><p>A tokenizer to convert string to BPE ids.</p>
<p>This op is especially convenient for mapping string text to a sequenec of word BPE
ids. The <code class="xref py py-obj docutils literal notranslate"><span class="pre">labels</span></code> strings are tokenized via BPE. This op is typically used in conjunction with BpeIdsToWords.
As the vocabulary file it receives the mapping from each word to the series of BPE ids.
An example of lines in the vocabulary file:
…
AARON 10005,16,29
AARON’S 10005,16,3466
AARONSON 10005,16,17,447
…</p>
<p>The output tensor <code class="xref py py-obj docutils literal notranslate"><span class="pre">token_ids</span></code> is a sequence of integer ids with &lt;s&gt; prepended.
The output tensor <code class="xref py py-obj docutils literal notranslate"><span class="pre">target_ids</span></code> is a sequence of integer ids with &lt;/s&gt; appended.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>labels</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>.
The batch of tf.String tensors. Expected shape is [batch_size].</p></li>
<li><p><strong>tokenization_filepath</strong> – A <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>.
A path to a text file where each line is a word separated with space form a list of ids which are separated by ‘,’.</p></li>
<li><p><strong>append_eos</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a>. Defaults to <a class="reference external" href="https://docs.python.org/3.7/library/constants.html#True" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>.</p></li>
<li><p><strong>maxlen</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">300</span></code>.
Maximum length of token_ids/target_ids/paddings.</p></li>
<li><p><strong>sos_id</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
<li><p><strong>eos_id</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">2</span></code>.</p></li>
<li><p><strong>name</strong> – A name for the operation (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>A tuple of <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> objects (token_ids, target_ids, paddings).</p>
<dl class="simple">
<dt>token_ids: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.</dt><dd><p>The ids with &lt;s&gt;. The shape is [batch_size, maxlen].</p>
</dd>
<dt>target_ids: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.</dt><dd><p>The ids with &lt;/s&gt;. The shape is [batch_size, maxlen].</p>
</dd>
<dt>paddings: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">float32</span></code>.</dt><dd><p>The paddings. The shape is [batch_size, maxlen].</p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.ops.static_map_string_int">
<code class="sig-prename descclassname">lingvo.core.ops.</code><code class="sig-name descname">static_map_string_int</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">keys</span></em>, <em class="sig-param"><span class="n">vals</span><span class="o">=</span><span class="default_value">[]</span></em>, <em class="sig-param"><span class="n">unk</span><span class="o">=</span><span class="default_value">- 1</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.ops.static_map_string_int" title="Permalink to this definition">¶</a></dt>
<dd><p>Maps every element of x according a static mapping.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>. A Tensor of type string.</p></li>
<li><p><strong>keys</strong> – A list of <code class="xref py py-obj docutils literal notranslate"><span class="pre">strings</span></code>. The list of keys.</p></li>
<li><p><strong>vals</strong> – An optional list of <code class="xref py py-obj docutils literal notranslate"><span class="pre">ints</span></code>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">[]</span></code>.
The list of values. If empty, defaults to [0 .. len(keys)).</p></li>
<li><p><strong>unk</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">-1</span></code>.
The value when the key is not found.</p></li>
<li><p><strong>name</strong> – A name for the operation (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>. A Tensor of type int32. Same shape of x.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.ops.static_map_int_string">
<code class="sig-prename descclassname">lingvo.core.ops.</code><code class="sig-name descname">static_map_int_string</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">vals</span></em>, <em class="sig-param"><span class="n">keys</span><span class="o">=</span><span class="default_value">[]</span></em>, <em class="sig-param"><span class="n">unk</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.ops.static_map_int_string" title="Permalink to this definition">¶</a></dt>
<dd><p>Maps every element of x according a static mapping.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>. A Tensor of type int32.</p></li>
<li><p><strong>vals</strong> – A list of <code class="xref py py-obj docutils literal notranslate"><span class="pre">strings</span></code>. The list of values.</p></li>
<li><p><strong>keys</strong> – An optional list of <code class="xref py py-obj docutils literal notranslate"><span class="pre">ints</span></code>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">[]</span></code>.
The list of keys. If empty, defaults to [0 .. len(keys)).</p></li>
<li><p><strong>unk</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>.
The value when the key is not found.</p></li>
<li><p><strong>name</strong> – A name for the operation (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>. A Tensor of type string. Same shape of x.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.ops.static_map_int_int">
<code class="sig-prename descclassname">lingvo.core.ops.</code><code class="sig-name descname">static_map_int_int</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">vals</span></em>, <em class="sig-param"><span class="n">keys</span><span class="o">=</span><span class="default_value">[]</span></em>, <em class="sig-param"><span class="n">unk</span><span class="o">=</span><span class="default_value">- 1</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.ops.static_map_int_int" title="Permalink to this definition">¶</a></dt>
<dd><p>Maps every element of x according a static mapping.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>. A Tensor of type int32.</p></li>
<li><p><strong>vals</strong> – A list of <code class="xref py py-obj docutils literal notranslate"><span class="pre">ints</span></code>. The list of values.</p></li>
<li><p><strong>keys</strong> – An optional list of <code class="xref py py-obj docutils literal notranslate"><span class="pre">ints</span></code>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">[]</span></code>.
The list of keys. If empty, defaults to [0 .. len(keys)).</p></li>
<li><p><strong>unk</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">-1</span></code>.
The value when the key is not found.</p></li>
<li><p><strong>name</strong> – A name for the operation (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>. A Tensor of type int32. Same shape of x.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.ops.get_preconditioners">
<code class="sig-prename descclassname">lingvo.core.ops.</code><code class="sig-name descname">get_preconditioners</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">shapes</span></em>, <em class="sig-param"><span class="n">preconditioner_compute_graphdef</span></em>, <em class="sig-param"><span class="n">keys</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.ops.get_preconditioners" title="Permalink to this definition">¶</a></dt>
<dd><p>Get preconditioners for Shampoo optimizer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>shapes</strong> – A list of at least 1 <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> objects with the same type in: <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">int64</span></code>.
A list of Tensors of type Tshape indicating the size of preconditioner.</p></li>
<li><p><strong>preconditioner_compute_graphdef</strong> – A <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>.
A graphdef which indicates the function to run.</p></li>
<li><p><strong>keys</strong> – A list of <code class="xref py py-obj docutils literal notranslate"><span class="pre">strings</span></code>.
A list of keys indicating the name of preconditioners.</p></li>
<li><p><strong>name</strong> – A name for the operation (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>A tuple of <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> objects (outputs, statuses).</p>
<p>outputs: A list with the same length as <code class="xref py py-obj docutils literal notranslate"><span class="pre">shapes</span></code> of <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> objects with type <code class="xref py py-obj docutils literal notranslate"><span class="pre">float32</span></code>. A list of Tensors of type float32 which are the preconditioners.
statuses: A list with the same length as <code class="xref py py-obj docutils literal notranslate"><span class="pre">shapes</span></code> of <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> objects with type <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a>. A list of Tensors of type bool which are the preconditioner status.</p>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.ops.compute_preconditioners">
<code class="sig-prename descclassname">lingvo.core.ops.</code><code class="sig-name descname">compute_preconditioners</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">inputs</span></em>, <em class="sig-param"><span class="n">exponents</span></em>, <em class="sig-param"><span class="n">global_step</span></em>, <em class="sig-param"><span class="n">preconditioner_compute_graphdef</span></em>, <em class="sig-param"><span class="n">keys</span></em>, <em class="sig-param"><span class="n">sync</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.ops.compute_preconditioners" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute preconditioners for Shampoo optimizer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputs</strong> – A list of at least 1 <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> objects with type <code class="xref py py-obj docutils literal notranslate"><span class="pre">float32</span></code>.
A list of Tensors of type float32, of statistic matrices.</p></li>
<li><p><strong>exponents</strong> – A list with the same length as <code class="xref py py-obj docutils literal notranslate"><span class="pre">inputs</span></code> of <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> objects with type <code class="xref py py-obj docutils literal notranslate"><span class="pre">float32</span></code>.
A list of scalar Tensors of type float32, exponent for matrix power.</p></li>
<li><p><strong>global_step</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.
A scalar Tensor of type int32 which indicates the global step.</p></li>
<li><p><strong>preconditioner_compute_graphdef</strong> – A <a class="reference external" href="https://docs.python.org/3.7/library/string.html#module-string" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">string</span></code></a>.
A graphdef which indicates the function to run.</p></li>
<li><p><strong>keys</strong> – A list of <code class="xref py py-obj docutils literal notranslate"><span class="pre">strings</span></code>.
A list of keys indicating the name of preconditioners.</p></li>
<li><p><strong>sync</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a>. Defaults to <a class="reference external" href="https://docs.python.org/3.7/library/constants.html#False" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">False</span></code></a>.
Boolean indicating whether to run preconditioning in synchronous mode.</p></li>
<li><p><strong>name</strong> – A name for the operation (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The created Operation.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.ops.pack_sequences">
<code class="sig-prename descclassname">lingvo.core.ops.</code><code class="sig-name descname">pack_sequences</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">src_actual_seq_len</span></em>, <em class="sig-param"><span class="n">tgt_actual_seq_len</span></em>, <em class="sig-param"><span class="n">packed_batch_size</span></em>, <em class="sig-param"><span class="n">packed_src_seq_len</span></em>, <em class="sig-param"><span class="n">packed_tgt_seq_len</span></em>, <em class="sig-param"><span class="n">seed</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.ops.pack_sequences" title="Permalink to this definition">¶</a></dt>
<dd><p>Produces a packing pattern for the (src, tgt) input pair with the provided</p>
<p>lengths, according to the given packed shape.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>src_actual_seq_len</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.
A tensor of shape [N], where N is the input batch size.
This tensor contains the actual lengths for the src sequence.</p></li>
<li><p><strong>tgt_actual_seq_len</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.
A tensor of shape [N], where N is the input batch size.
This tensor contains the actual lengths for the tgt sequence.</p></li>
<li><p><strong>packed_batch_size</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.
A scalar. The output batch size. The packed output will
be of shape [packed_batch_size, packed_{src,tgt}_seq_len] for src and tgt,
respectively.</p></li>
<li><p><strong>packed_src_seq_len</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.
A scalar. The output sequence length for src. A src input
with shape [N, src_input_seq_len] will be packed into an output with shape
[packed_batch_size, packed_src_seq_len].</p></li>
<li><p><strong>packed_tgt_seq_len</strong> – <p>A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.
A scalar. The output sequence length for tgt. A tgt input</p>
<blockquote>
<div><p>with shape [N, tgt_input_seq_len] will be packed into an output with shape
[packed_batch_size, packed_tgt_seq_len].</p>
</div></blockquote>
<dl class="simple">
<dt>{src,tgt}_segment_ids: A tensor of shape [packed_batch_size,</dt><dd><p>packed_{src,tgt}_seq_len]. Incrementing from 1 to indicate each segment in the
packed output, for src and tgt, respectively. Zero is reserved for indicating
padding at the end of each row.</p>
</dd>
<dt>{src,tgt}_segment_pos: A tensor of shape [packed_batch_size,</dt><dd><p>packed_{src,tgt}_seq_len]. Zero-based index to indicate relative position
within each segment, for src and tgt, respectively. Zero is also used to
indicate padding. When needed, use <code class="xref py py-obj docutils literal notranslate"><span class="pre">{src,tgt}_segment_ids</span></code> to disambiguate.</p>
</dd>
<dt>{src,tgt}_indices_in_input: A tensor of shape [packed_batch_size,</dt><dd><p>packed_{src,tgt}_seq_len]. For each segment in the packed output, it contains
the original (zero-based) row index of each segment found in
<code class="xref py py-obj docutils literal notranslate"><span class="pre">{src,tgt}_actual_seq_len</span></code>, respectively. Zero is also used to indicate
padding. When needed, use <code class="xref py py-obj docutils literal notranslate"><span class="pre">{src,tgt}_segment_ids</span></code> to disambiguate.</p>
</dd>
</dl>
</p></li>
<li><p><strong>seed</strong> – <p>An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">0</span></code>.
Seed for random number generator, which is used when we need to drop</p>
<blockquote>
<div><p>excessive input sequences. If seed is zero, use completely random seed.</p>
</div></blockquote>
<dl class="simple">
<dt>For example, the following input:</dt><dd><p>src_actual_seq_len = [3, 2, 1]
tgt_actual_seq_len = [4, 1, 5]
packed_batch_size = 2
packed_src_seq_len = 5
packed_tgt_seq_len = 5</p>
</dd>
<dt>will result in:</dt><dd><p>src_segment_ids = [ [1, 1, 1, 2, 2], [1, 0, 0, 0, 0] ]
src_segment_pos = [ [0, 1, 2, 0, 1], [0, 0, 0, 0, 0] ]
src_indices_in_input = [ [0, 0, 0, 1, 1], [2, 0, 0, 0, 0] ]
tgt_segment_ids = [ [1, 1, 1, 1, 2], [1, 1, 1, 1, 1] ]
tgt_segment_pos = [ [0, 1, 2, 3, 0], [0, 1, 2, 3, 4] ]
tgt_indices_in_input = [ [0, 0, 0, 0, 1], [2, 2, 2, 2, 2] ]</p>
</dd>
</dl>
<p>The packed sequence length can be different between src and tgt. For example,
the following input:</p>
<blockquote>
<div><p>src_actual_seq_len = [3, 2, 1]
tgt_actual_seq_len = [4, 1, 5]
packed_batch_size = 2
packed_src_seq_len = 4
packed_tgt_seq_len = 6</p>
</div></blockquote>
<dl class="simple">
<dt>will result in:</dt><dd><p>src_segment_ids = [ [1, 1, 1, 0], [1, 1, 2, 0] ]
src_segment_pos = [ [0, 1, 2, 0], [0, 1, 0, 0] ]
src_indices_in_input = [ [0, 0, 0, 0], [1, 1, 2, 0] ]
tgt_segment_ids = [ [1, 1, 1, 1, 0, 0], [1, 2, 2, 2, 2, 2] ]
tgt_segment_pos = [ [0, 1, 2, 3, 0, 0], [0, 0, 1, 2, 3, 4] ]
tgt_indices_in_input = [ [0, 0, 0, 0, 0, 0], [1, 2, 2, 2, 2, 2] ]</p>
</dd>
</dl>
<p>If there are too few input sequences to pack into <code class="xref py py-obj docutils literal notranslate"><span class="pre">output_shape</span></code>, the op pads
the remaining elements in the output.</p>
<p>If there are too many input sequences to pack into <code class="xref py py-obj docutils literal notranslate"><span class="pre">output_shape</span></code>, the op drops
input sequences. The dropping is done randomly uniformly on the input sequences
to not bias the distribution of sequence lengths in the packed output.</p>
</p></li>
<li><p><strong>name</strong> – A name for the operation (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>A tuple of <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> objects (src_segment_ids, src_segment_pos, src_indices_in_input, tgt_segment_ids, tgt_segment_pos, tgt_indices_in_input).</p>
<p>src_segment_ids: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.
src_segment_pos: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.
src_indices_in_input: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.
tgt_segment_ids: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.
tgt_segment_pos: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.
tgt_indices_in_input: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.</p>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.ops.apply_packing">
<code class="sig-prename descclassname">lingvo.core.ops.</code><code class="sig-name descname">apply_packing</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">input</span></em>, <em class="sig-param"><span class="n">padding</span></em>, <em class="sig-param"><span class="n">segment_ids</span></em>, <em class="sig-param"><span class="n">indices_in_input</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.ops.apply_packing" title="Permalink to this definition">¶</a></dt>
<dd><p>Applies a packing pattern on the input to obtain a packed output.</p>
<p>A slightly different semantics when T is tf.string type: the output joins the
strings that are packed on the same row, separated by <code class="xref py py-obj docutils literal notranslate"><span class="pre">padding</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code>.
A tensor of shape [N, seq_len]. The input to apply the packing to.
For tf.string typed input, a vector of shape [N] is expected.</p></li>
<li><p><strong>padding</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code>. Must have the same type as <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#input" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">input</span></code></a>.
A scalar to indicate the padding value. This is typically the zero
value of T, but may not always be the case, e.g. when the input is a paddings
tensor, in which case caller should set padding=1.
For tf.string typed input, padding is used as a separator to join all the
strings on the same row in the output.</p></li>
<li><p><strong>segment_ids</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.
A rank 2 tensor of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">output_shape</span></code>.</p></li>
<li><p><strong>indices_in_input</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.
A rank 2 tensor of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">output_shape</span></code>.</p></li>
<li><p><strong>name</strong> – A name for the operation (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code>. Has the same type as <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#input" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">input</span></code></a>.
A tensor of shape <code class="xref py py-obj docutils literal notranslate"><span class="pre">output_shape</span></code>. For tf.string typed input, the output</p>
<blockquote>
<div><p>is a vector of strings where its length is the same as the number of rows in
<code class="xref py py-obj docutils literal notranslate"><span class="pre">output_shape</span></code>.</p>
</div></blockquote>
<p>The inputs <code class="xref py py-obj docutils literal notranslate"><span class="pre">segment_ids</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">indices_in_input</span></code> can be obtained from the outputs
of an <code class="xref py py-obj docutils literal notranslate"><span class="pre">PackSequence</span></code> op (though only the src or the tgt tensors are needed).</p>
<p>Note that ApplyPacking is done on a per column basis (either on the src or on
the tgt), as opposed to in PackSequences, when both src and tgt columns must be
processed together within the same op.</p>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="lingvo.core.ops.mass">
<code class="sig-prename descclassname">lingvo.core.ops.</code><code class="sig-name descname">mass</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ids</span></em>, <em class="sig-param"><span class="n">weights</span></em>, <em class="sig-param"><span class="n">actual_seq_len</span></em>, <em class="sig-param"><span class="n">mask_id</span></em>, <em class="sig-param"><span class="n">vocab_size</span></em>, <em class="sig-param"><span class="n">mask_ratio</span><span class="o">=</span><span class="default_value">0.5</span></em>, <em class="sig-param"><span class="n">mask_minlen</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">span_len</span><span class="o">=</span><span class="default_value">100000</span></em>, <em class="sig-param"><span class="n">random_start_prob</span><span class="o">=</span><span class="default_value">0.6</span></em>, <em class="sig-param"><span class="n">keep_prob</span><span class="o">=</span><span class="default_value">0.1</span></em>, <em class="sig-param"><span class="n">rand_prob</span><span class="o">=</span><span class="default_value">0.1</span></em>, <em class="sig-param"><span class="n">mask_prob</span><span class="o">=</span><span class="default_value">0.8</span></em>, <em class="sig-param"><span class="n">mask_target</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">first_unreserved_id</span><span class="o">=</span><span class="default_value">4</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.core.ops.mass" title="Permalink to this definition">¶</a></dt>
<dd><p>Applies masking to implement MASS.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ids</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>.
Tensor of shape [batch_size, max_seq_len] containing the token ids.
Should include EOS token &lt;/s&gt;.</p></li>
<li><p><strong>weights</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">float32</span></code>.
Tensor of shape [batch_size, max_seq_len].</p></li>
<li><p><strong>actual_seq_len</strong> – A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>. Tensor of shape [batch_size].</p></li>
<li><p><strong>mask_id</strong> – An <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>. The id to use for the mask token.</p></li>
<li><p><strong>vocab_size</strong> – An <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>.
Vocab size used when selecting a random token to replace a masked
token.</p></li>
<li><p><strong>mask_ratio</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#float" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">0.5</span></code>.
Proportion of src to mask.</p></li>
<li><p><strong>mask_minlen</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">0</span></code>.
Skip sentences too short to mask at least this many tokens.</p></li>
<li><p><strong>span_len</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">100000</span></code>.
Split mask_len into segments of this size and randomly distribute
those across the src.</p></li>
<li><p><strong>random_start_prob</strong> – <p>An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#float" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">0.6</span></code>.
The probability that the placement of masked segments will be</p>
<blockquote>
<div><p>entirely random. The remaining cases are split evenly between masking at the
beginning and at the end of the src.</p>
</div></blockquote>
<p>keep_prob/rand_prob/mask_prob: The probability that a token to be masked will
be unchanged, replaced with a random token in the vocab, or replaced with the
mask_id, respectively. Must sum to 1.</p>
</p></li>
<li><p><strong>keep_prob</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#float" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">0.1</span></code>.</p></li>
<li><p><strong>rand_prob</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#float" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">0.1</span></code>.</p></li>
<li><p><strong>mask_prob</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#float" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">0.8</span></code>.</p></li>
<li><p><strong>mask_target</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a>. Defaults to <a class="reference external" href="https://docs.python.org/3.7/library/constants.html#True" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>.
whether to mask the target (the mask will be the inverse of that of
the src).</p></li>
<li><p><strong>first_unreserved_id</strong> – An optional <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>. Defaults to <code class="xref py py-obj docutils literal notranslate"><span class="pre">4</span></code>.
Tokens greater than or equal to this may be selected at
random to replace a masked token.</p></li>
<li><p><strong>name</strong> – A name for the operation (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>A tuple of <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> objects (src_ids, tgt_ids, tgt_labels, tgt_weights).</p>
<p>src_ids: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>. Masked ids. E.g. s1 s2 s3 m m &lt;/s&gt;
tgt_ids: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>. Right-shifted ids with BOS token added, where the mask is the</p>
<blockquote>
<div><p>positional inverse of that of the source unless mask_target=False.
E.g. m m m s3 s4 m</p>
</div></blockquote>
<p>tgt_labels: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>. E.g. s1 s2 s3 s4 s5 &lt;/s&gt;
tgt_weights: A <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">float32</span></code>. weights are zeroed wherever the target is masked.</p>
</p>
</dd>
</dl>
</dd></dl>

<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="lingvo.core.ops.hyps_pb2.html">lingvo.core.ops.hyps_pb2 module</a></li>
<li class="toctree-l1"><a class="reference internal" href="lingvo.core.ops.record_pb2.html">lingvo.core.ops.record_pb2 module</a></li>
<li class="toctree-l1"><a class="reference internal" href="lingvo.core.ops.x_ops.html">lingvo.core.ops.x_ops module</a></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="lingvo.core.ops.hyps_pb2.html" class="btn btn-neutral float-right" title="lingvo.core.ops.hyps_pb2 module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="lingvo.core.html" class="btn btn-neutral float-left" title="lingvo.core package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2018

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>