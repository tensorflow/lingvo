

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>lingvo.tasks.asr.decoder module &mdash; Lingvo  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="lingvo.tasks.asr.decoder_metrics module" href="lingvo.tasks.asr.decoder_metrics.html" />
    <link rel="prev" title="lingvo.tasks.asr.contextualizer_base module" href="lingvo.tasks.asr.contextualizer_base.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Lingvo
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="lingvo.html">lingvo package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="lingvo.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="lingvo.core.html">lingvo.core package</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="lingvo.tasks.html">lingvo.tasks package</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="lingvo.tasks.html#subpackages">Subpackages</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tools.html">lingvo.tools package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="lingvo.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Lingvo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="lingvo.html">lingvo package</a> &raquo;</li>
        
          <li><a href="lingvo.tasks.html">lingvo.tasks package</a> &raquo;</li>
        
          <li><a href="lingvo.tasks.asr.html">lingvo.tasks.asr package</a> &raquo;</li>
        
      <li>lingvo.tasks.asr.decoder module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/lingvo.tasks.asr.decoder.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="module-lingvo.tasks.asr.decoder">
<span id="lingvo-tasks-asr-decoder-module"></span><h1>lingvo.tasks.asr.decoder module<a class="headerlink" href="#module-lingvo.tasks.asr.decoder" title="Permalink to this headline">¶</a></h1>
<p>Decoders for the speech model.</p>
<dl class="py function">
<dt id="lingvo.tasks.asr.decoder._ToTensorArray">
<code class="sig-prename descclassname"><span class="pre">lingvo.tasks.asr.decoder.</span></code><code class="sig-name descname"><span class="pre">_ToTensorArray</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">v</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_seq_length</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clear_after_read</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#_ToTensorArray"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder._ToTensorArray" title="Permalink to this definition">¶</a></dt>
<dd><p>Create TensorArray from v, of size max_seq_length.</p>
</dd></dl>

<dl class="py function">
<dt id="lingvo.tasks.asr.decoder._NewTensorArray">
<code class="sig-prename descclassname"><span class="pre">lingvo.tasks.asr.decoder.</span></code><code class="sig-name descname"><span class="pre">_NewTensorArray</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_seq_length</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#_NewTensorArray"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder._NewTensorArray" title="Permalink to this definition">¶</a></dt>
<dd><p>Create empty TensorArray which can store max_seq_length elements.</p>
</dd></dl>

<dl class="py class">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">lingvo.tasks.asr.decoder.</span></code><code class="sig-name descname"><span class="pre">AsrDecoderBase</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_decoder.html#lingvo.core.base_decoder.BaseBeamSearchDecoder" title="lingvo.core.base_decoder.BaseBeamSearchDecoder"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_decoder.BaseBeamSearchDecoder</span></code></a></p>
<p>Base class for RNN-with-attention speech decoders.</p>
<p>The decoder takes encoder_outputs, a NestedMap generated by the encoder, as
input. The NestedMap is expected to contain the following fields:</p>
<blockquote>
<div><ul class="simple">
<li><p>‘encoded’: encoded features</p></li>
<li><p>‘padding’: padding for encoded features</p></li>
</ul>
</div></blockquote>
<p>The decoder operates in a ‘step-by-step’ fashion. The model encapsulates all
information which should persist from one step to the next in the
DecoderStepState NestedMap, which provides a ‘misc_states’ NestedMap which can
store arbitrary information required by the specific decoder sub-class.</p>
<p>A ‘step’ in training consists of the following sequence of steps which compute
the outputs from the decoder given the current input target (and the state of
the model after making the previous predictions):</p>
<ol class="arabic">
<li><p>Compute the input target at the current time step:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cur_target_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TargetsToBeFedAtCurrentDecodeStep</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Update state and compute outputs by running SingleDecodeStep:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">step_outs</span><span class="p">,</span> <span class="n">new_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SingleDecodeStep</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Update state based on the logits computed at this step:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PostStepDecoderStateUpdate</span><span class="p">(</span><span class="n">old_state</span><span class="p">,</span> <span class="n">logits</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Display summaries based on the accumulated information across all steps:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">AddAdditionalDecoderSummaries</span><span class="p">(</span><span class="n">seq_out_tas</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
<p>Sub-classes can customize behavior by implementing the following functions,
which will modify the behavior of the decoder:</p>
<dl class="simple">
<dt>For beam search decoder:</dt><dd><ul class="simple">
<li><p>_InitBeamSearchStateCallback</p></li>
<li><p>_PreBeamSearchStepCallback</p></li>
<li><p>_PostBeamSearchStepCallback</p></li>
</ul>
</dd>
<dt>For EMBR training:</dt><dd><ul class="simple">
<li><p>ComputeHypsWithBeamSearch</p></li>
</ul>
</dd>
</dl>
<ul class="simple">
<li><p>MiscZeroState: NestedMap which represents the initial state for the
‘misc_states’ in the DecoderStepState. The default implementation returns
an empty NestedMap.</p></li>
<li><p>SingleDecodeStep: This corresponds to the computation which happens in each
step of the model. The function should return the outputs of the decoder
as well as the updated state.</p></li>
<li><p>PostStepDecoderStateUpdate: A function which updates the DecoderStepState
after the output logits from the decoder have been computed. By default,
this returns the DecoderStepState unchanged.</p></li>
<li><p>TargetsToBeFedAtCurrentDecodeStep: Returns a TargetInfo namedtuple, which
represents information about the targets which should be input at the
current step, as well as the output label which should be predicted.
The default implementation uses the values in the batched ‘targets’
provided by the InputGenerator.</p></li>
<li><p>AddAdditionalDecoderSummaries: A function which can be used to add any
decoder specific information as part of the summaries displayed during
training. By default this is a no-op.</p></li>
<li><p>CreateTargetInfoMisc: A function which can be used to store arbitrary
information as required by a sub-classes in the target info arrays used
to determine the current label at each step during training. By default,
this creates an empty NestedMap.</p></li>
</ul>
<p>A few other functions that control how the decoder initializes and computes
attention during the initial step, and during each step can also be
modified, if need be:</p>
<ul class="simple">
<li><p>_GetAttenContextDim: The dimensionality of the attention context vector.</p></li>
<li><p>_CreateAtten: Controls how the attention module is configured. Most
subclasses will not have to change this unless it changes how attention
works.</p></li>
<li><p>BaseZeroState: Returns initial state of RNNs, and attention.</p></li>
<li><p>_InitAttention: Initializes Tensors used by the attention module.</p></li>
<li><p>_GetInitialSeqStateTensorArrays: Get intitial tensor arrays for
ComputePredictionsDynamic.</p></li>
<li><p>_GetNewAttenProbs: Update atten probs for a timestep and return the
updated tensor array.</p></li>
</ul>
<dl class="py class">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo">
<em class="property"><span class="pre">class</span> </em><code class="sig-name descname"><span class="pre">TargetInfo</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">emb</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">padding</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">misc</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#tuple" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a></p>
<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._asdict">
<code class="sig-name descname"><span class="pre">_asdict</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._asdict" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new dict which maps field names to their values.</p>
</dd></dl>

<dl class="py attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._field_defaults">
<code class="sig-name descname"><span class="pre">_field_defaults</span></code><em class="property"> <span class="pre">=</span> <span class="pre">{}</span></em><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._field_defaults" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._fields">
<code class="sig-name descname"><span class="pre">_fields</span></code><em class="property"> <span class="pre">=</span> <span class="pre">('id',</span> <span class="pre">'label',</span> <span class="pre">'weight',</span> <span class="pre">'emb',</span> <span class="pre">'padding',</span> <span class="pre">'misc')</span></em><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._fields" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._fields_defaults">
<code class="sig-name descname"><span class="pre">_fields_defaults</span></code><em class="property"> <span class="pre">=</span> <span class="pre">{}</span></em><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._fields_defaults" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._make">
<em class="property"><span class="pre">classmethod</span> </em><code class="sig-name descname"><span class="pre">_make</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">iterable</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._make" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a new TargetInfo object from a sequence or iterable</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._replace">
<code class="sig-name descname"><span class="pre">_replace</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._replace" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new TargetInfo object replacing specified fields with new values</p>
</dd></dl>

<dl class="py attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.emb">
<code class="sig-name descname"><span class="pre">emb</span></code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.emb" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 3</p>
</dd></dl>

<dl class="py attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.id">
<code class="sig-name descname"><span class="pre">id</span></code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.id" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

<dl class="py attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.label">
<code class="sig-name descname"><span class="pre">label</span></code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.label" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

<dl class="py attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.misc">
<code class="sig-name descname"><span class="pre">misc</span></code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.misc" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 5</p>
</dd></dl>

<dl class="py attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.padding">
<code class="sig-name descname"><span class="pre">padding</span></code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.padding" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 4</p>
</dd></dl>

<dl class="py attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.weight">
<code class="sig-name descname"><span class="pre">weight</span></code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.weight" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 2</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays">
<em class="property"><span class="pre">class</span> </em><code class="sig-name descname"><span class="pre">SequenceOutTensorArrays</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rnn_outs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step_outs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">atten_probs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fusion</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">misc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">confidence_logits</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#tuple" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a></p>
<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._asdict">
<code class="sig-name descname"><span class="pre">_asdict</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._asdict" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new dict which maps field names to their values.</p>
</dd></dl>

<dl class="py attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._field_defaults">
<code class="sig-name descname"><span class="pre">_field_defaults</span></code><em class="property"> <span class="pre">=</span> <span class="pre">{}</span></em><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._field_defaults" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._fields">
<code class="sig-name descname"><span class="pre">_fields</span></code><em class="property"> <span class="pre">=</span> <span class="pre">('rnn_outs',</span> <span class="pre">'step_outs',</span> <span class="pre">'atten_probs',</span> <span class="pre">'logits',</span> <span class="pre">'fusion',</span> <span class="pre">'misc',</span> <span class="pre">'confidence_logits')</span></em><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._fields" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._fields_defaults">
<code class="sig-name descname"><span class="pre">_fields_defaults</span></code><em class="property"> <span class="pre">=</span> <span class="pre">{}</span></em><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._fields_defaults" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._make">
<em class="property"><span class="pre">classmethod</span> </em><code class="sig-name descname"><span class="pre">_make</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">iterable</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._make" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a new SequenceOutTensorArrays object from a sequence or iterable</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._replace">
<code class="sig-name descname"><span class="pre">_replace</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._replace" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new SequenceOutTensorArrays object replacing specified fields with new values</p>
</dd></dl>

<dl class="py attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.atten_probs">
<code class="sig-name descname"><span class="pre">atten_probs</span></code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.atten_probs" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 2</p>
</dd></dl>

<dl class="py attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.confidence_logits">
<code class="sig-name descname"><span class="pre">confidence_logits</span></code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.confidence_logits" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 6</p>
</dd></dl>

<dl class="py attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.fusion">
<code class="sig-name descname"><span class="pre">fusion</span></code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.fusion" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 4</p>
</dd></dl>

<dl class="py attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.logits">
<code class="sig-name descname"><span class="pre">logits</span></code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.logits" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 3</p>
</dd></dl>

<dl class="py attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.misc">
<code class="sig-name descname"><span class="pre">misc</span></code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.misc" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 5</p>
</dd></dl>

<dl class="py attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.rnn_outs">
<code class="sig-name descname"><span class="pre">rnn_outs</span></code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.rnn_outs" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

<dl class="py attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.step_outs">
<code class="sig-name descname"><span class="pre">step_outs</span></code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.step_outs" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.Params">
<em class="property"><span class="pre">classmethod</span> </em><code class="sig-name descname"><span class="pre">Params</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.Params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.UpdateTargetVocabSize">
<em class="property"><span class="pre">classmethod</span> </em><code class="sig-name descname"><span class="pre">UpdateTargetVocabSize</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">p</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vocab_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wpm_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.UpdateTargetVocabSize"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.UpdateTargetVocabSize" title="Permalink to this definition">¶</a></dt>
<dd><p>Updates params with the vocab size and wpm model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>p</strong> – model params.</p></li>
<li><p><strong>vocab_size</strong> – size of the vocabulary.</p></li>
<li><p><strong>wpm_model</strong> – file name prefix pointing to a wordpiece model.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Model params updated with the vocab size and wpm model.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._CreateAtten">
<code class="sig-name descname"><span class="pre">_CreateAtten</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._CreateAtten"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._CreateAtten" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._GetAttenContextDim">
<code class="sig-name descname"><span class="pre">_GetAttenContextDim</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._GetAttenContextDim"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._GetAttenContextDim" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._ApplyDropout">
<code class="sig-name descname"><span class="pre">_ApplyDropout</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_in</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deterministic</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extra_seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._ApplyDropout"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._ApplyDropout" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._InitAttention">
<code class="sig-name descname"><span class="pre">_InitAttention</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">encoder_outputs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._InitAttention"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._InitAttention" title="Permalink to this definition">¶</a></dt>
<dd><p>Intializes attention and returns a NestedMap with those values.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._GetEncoderPaddings">
<code class="sig-name descname"><span class="pre">_GetEncoderPaddings</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">encoder_outputs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._GetEncoderPaddings"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._GetEncoderPaddings" title="Permalink to this definition">¶</a></dt>
<dd><p>Get Encoder Paddings from encoder_outputs.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.BaseZeroState">
<code class="sig-name descname"><span class="pre">BaseZeroState</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">encoder_outputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">misc_zero_states</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">per_step_source_padding</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.BaseZeroState"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.BaseZeroState" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns initial state of RNNs, and attention.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.AddAdditionalDecoderSummaries">
<code class="sig-name descname"><span class="pre">AddAdditionalDecoderSummaries</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">encoder_outputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seq_out_tas</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">softmax_input</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.AddAdditionalDecoderSummaries"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.AddAdditionalDecoderSummaries" title="Permalink to this definition">¶</a></dt>
<dd><p>Additional model-specific summaries which should be displayed.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.DecoderStepZeroState">
<code class="sig-name descname"><span class="pre">DecoderStepZeroState</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">encoder_outputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_ids</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.DecoderStepZeroState"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.DecoderStepZeroState" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._AddDecoderActivationsSummary">
<code class="sig-name descname"><span class="pre">_AddDecoderActivationsSummary</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">encoder_outputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">atten_probs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rnn_outs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">softmax_input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">additional_atten_probs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_alignments</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._AddDecoderActivationsSummary"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._AddDecoderActivationsSummary" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds summary about decoder activations.</p>
<p>For each of the args, a TensorArray can also be a Tensor representing
the stacked array.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>encoder_outputs</strong> – a NestedMap computed by encoder.</p></li>
<li><p><strong>targets</strong> – a NestedMap, usually input_batch.tgt.</p></li>
<li><p><strong>atten_probs</strong> – a TensorArray of max_target_length elements, each of shape
[batch, max_source_length].</p></li>
<li><p><strong>rnn_outs</strong> – a list of TensorArray, one for each RNN layer. Each TensorArray
has max_target_length elements, each of shape [batch, rnn_output_dim].</p></li>
<li><p><strong>softmax_input</strong> – a Tensor of shape [batch, max_target_length, vocab_size].</p></li>
<li><p><strong>additional_atten_probs</strong> – an optional list of (name, TensorArray) to display
along with atten_probs.</p></li>
<li><p><strong>target_alignments</strong> – an optional Tensor of shape [batch, max_target_length]
where every value is an int32 in the range of [1, max_source_length],
representing number of source frames by which a target label should be
emitted.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A finalized figure.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._ComputeMetrics">
<code class="sig-name descname"><span class="pre">_ComputeMetrics</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">logits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_labels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_weights</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_probs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._ComputeMetrics"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._ComputeMetrics" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute loss and misc metrics.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>logits</strong> – Tensor of shape [batch, time, num_classes].</p></li>
<li><p><strong>target_labels</strong> – Tensor of shape [batch, time].</p></li>
<li><p><strong>target_weights</strong> – Tensor of shape [batch, time].</p></li>
<li><p><strong>target_probs</strong> – Tensor of shape [batch, time, num_classes].</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A (metrics, per_sequence_loss) pair.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.InitDecoder">
<code class="sig-name descname"><span class="pre">InitDecoder</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">encoder_outputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dec_bs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.InitDecoder"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.InitDecoder" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._InitBeamSearchStateCallback">
<code class="sig-name descname"><span class="pre">_InitBeamSearchStateCallback</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">encoder_outputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_hyps_per_beam</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._InitBeamSearchStateCallback"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._InitBeamSearchStateCallback" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._PreBeamSearchStepCallback">
<code class="sig-name descname"><span class="pre">_PreBeamSearchStepCallback</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">encoder_outputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step_ids</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">states</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_hyps_per_beam</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._PreBeamSearchStepCallback"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._PreBeamSearchStepCallback" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._PostBeamSearchStepCallback">
<code class="sig-name descname"><span class="pre">_PostBeamSearchStepCallback</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">encoder_outputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_step_ids</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">states</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._PostBeamSearchStepCallback"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._PostBeamSearchStepCallback" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.ComputeLoss">
<code class="sig-name descname"><span class="pre">ComputeLoss</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictions</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targets</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.ComputeLoss"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.ComputeLoss" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes loss metrics and per-sequence losses.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> – A NestedMap object containing weights’ values of this layer and its
children layers.</p></li>
<li><p><strong>predictions</strong> – A NestedMap containing logits (and possibly other fields).</p></li>
<li><p><strong>targets</strong> – A dict of string to tensors representing the targets one is
trying to predict. Each tensor in targets is of shape [batch, time].</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>(metrics, per_sequence_loss), where metrics is a dictionary containing
metrics for the xent loss and prediction accuracy. per_sequence is a
dictionary containing ‘loss’, a (-log(p)) vector of size [bs].</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.CreateTargetInfoMisc">
<code class="sig-name descname"><span class="pre">CreateTargetInfoMisc</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">targets</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.CreateTargetInfoMisc"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.CreateTargetInfoMisc" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a NestedMap corresponding to the ‘misc’ field in TargetInfo.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.ComputePredictions">
<code class="sig-name descname"><span class="pre">ComputePredictions</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">encoder_outputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targets</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.ComputePredictions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.ComputePredictions" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes logits.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> – A NestedMap object containing weights values of this layer and its
child layers.</p></li>
<li><p><strong>encoder_outputs</strong> – a NestedMap computed by encoder.</p></li>
<li><p><strong>targets</strong> – A dict of string to tensors representing the targets one is
trying to predict. Each tensor in targets is of shape [batch, time].</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A NestedMap object containing logit tensors as values, each of shape
[target_batch, max_target_length, vocab_size]. One of the keys must be
‘logits’.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._GetInitialSeqStateTensorArrays">
<code class="sig-name descname"><span class="pre">_GetInitialSeqStateTensorArrays</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">max_seq_length</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decoder_step_state_zero_fusion_flat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decoder_step_state_zero_misc_flat</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._GetInitialSeqStateTensorArrays"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._GetInitialSeqStateTensorArrays" title="Permalink to this definition">¶</a></dt>
<dd><p>Get intitial tensor arrays for ComputePredictionsDynamic.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._GetNewAttenProbs">
<code class="sig-name descname"><span class="pre">_GetNewAttenProbs</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">seq_out_tas</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decoder_step_state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._GetNewAttenProbs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._GetNewAttenProbs" title="Permalink to this definition">¶</a></dt>
<dd><p>Update atten probs for a timestep and return the updated tensor array.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._UpdateSequenceOutTensorArrays">
<code class="sig-name descname"><span class="pre">_UpdateSequenceOutTensorArrays</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">decoder_step_state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step_outs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seq_out_tas</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._UpdateSequenceOutTensorArrays"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._UpdateSequenceOutTensorArrays" title="Permalink to this definition">¶</a></dt>
<dd><p>Update SequenceOutTensorArrays at each time step.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._GetAttenProbsFromSequenceOutTensorArrays">
<code class="sig-name descname"><span class="pre">_GetAttenProbsFromSequenceOutTensorArrays</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">atten_probs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._GetAttenProbsFromSequenceOutTensorArrays"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._GetAttenProbsFromSequenceOutTensorArrays" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._GetPredictionFromSequenceOutTensorArrays">
<code class="sig-name descname"><span class="pre">_GetPredictionFromSequenceOutTensorArrays</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">seq_out_tas</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._GetPredictionFromSequenceOutTensorArrays"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._GetPredictionFromSequenceOutTensorArrays" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._GetInitialTargetInfo">
<code class="sig-name descname"><span class="pre">_GetInitialTargetInfo</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">targets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_seq_length</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_embs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._GetInitialTargetInfo"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._GetInitialTargetInfo" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.ComputePredictionsDynamic">
<code class="sig-name descname"><span class="pre">ComputePredictionsDynamic</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">encoder_outputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targets</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.ComputePredictionsDynamic"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.ComputePredictionsDynamic" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.ComputePredictionsFunctional">
<code class="sig-name descname"><span class="pre">ComputePredictionsFunctional</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">encoder_outputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targets</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.ComputePredictionsFunctional"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.ComputePredictionsFunctional" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._ComputeLogits">
<code class="sig-name descname"><span class="pre">_ComputeLogits</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">softmax_input</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._ComputeLogits"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._ComputeLogits" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._ExtractConfidenceFeatures">
<code class="sig-name descname"><span class="pre">_ExtractConfidenceFeatures</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">atten_dists</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">topk</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lm_output</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._ExtractConfidenceFeatures"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._ExtractConfidenceFeatures" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SingleDecodeStep">
<code class="sig-name descname"><span class="pre">SingleDecodeStep</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">packed_src</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cur_target_info</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decoder_step_state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">per_step_src_padding</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_deterministic_random</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.SingleDecodeStep"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SingleDecodeStep" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes one ‘step’ of computation for the decoder.</p>
<p>Must be implemented by sub-classes. Residual connections must also be taken
care of in sub-classes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> – A NestedMap object containing weights’ values of this layer and its
children layers.</p></li>
<li><p><strong>packed_src</strong> – A NestedMap to represent the packed source tensors generated
by the attention model.</p></li>
<li><p><strong>cur_target_info</strong> – TargetInfo namedtuple, which represents the targets which
represents information about the target at this step. It is up to the
various sub-classes to determine how to process the current target.</p></li>
<li><p><strong>decoder_step_state</strong> – DecoderStepState which encapsulates the state of the
decoder before computing outputs at the current step.</p></li>
<li><p><strong>per_step_src_padding</strong> – Optional padding to be applied to the source_encs
which overrides the default padding in source_paddings. Used, for
example, by the Neural Transducer (NT) decoder.</p></li>
<li><p><strong>use_deterministic_random</strong> – whether to use deterministic random numbers when
needed. Must be set to True if called from functional recurrent.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tuple (step_out, new_decoder_state) which represent the outputs of the
decoder (usually logits), and the new decoder state after processing the
current step.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.MiscZeroState">
<code class="sig-name descname"><span class="pre">MiscZeroState</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">encoder_outputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_ids</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.MiscZeroState"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.MiscZeroState" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns initial state for other miscellaneous states, if any.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetsToBeFedAtCurrentDecodeStep">
<code class="sig-name descname"><span class="pre">TargetsToBeFedAtCurrentDecodeStep</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decoder_step_state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_info_tas</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seq_out_tas</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.TargetsToBeFedAtCurrentDecodeStep"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetsToBeFedAtCurrentDecodeStep" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.PostStepDecoderStateUpdate">
<code class="sig-name descname"><span class="pre">PostStepDecoderStateUpdate</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">decoder_step_state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logits</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.PostStepDecoderStateUpdate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.PostStepDecoderStateUpdate" title="Permalink to this definition">¶</a></dt>
<dd><p>Update decoder states and logits after SingleDecodeStep.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>decoder_step_state</strong> – A NestedMap object which encapsulates decoder states.</p></li>
<li><p><strong>logits</strong> – a tensor, predicted logits.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>decoder_step_state.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#ValueError" title="(in Python v3.7)"><strong>ValueError</strong></a> – if scheduled sampling is used for functional unrolling or
    if logits is None for while loop based unrolling.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">lingvo.tasks.asr.decoder.</span></code><code class="sig-name descname"><span class="pre">AsrDecoder</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.tasks.asr.decoder.AsrDecoderBase" title="lingvo.tasks.asr.decoder.AsrDecoderBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.tasks.asr.decoder.AsrDecoderBase</span></code></a></p>
<p>Step-by-step decoder with LM fusion.</p>
<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder.Params">
<em class="property"><span class="pre">classmethod</span> </em><code class="sig-name descname"><span class="pre">Params</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder.Params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder.AddAdditionalDecoderSummaries">
<code class="sig-name descname"><span class="pre">AddAdditionalDecoderSummaries</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">encoder_outputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seq_out_tas</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">softmax_input</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder.AddAdditionalDecoderSummaries"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder.AddAdditionalDecoderSummaries" title="Permalink to this definition">¶</a></dt>
<dd><p>Add summaries not covered by the default activations summaries.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>encoder_outputs</strong> – a NestedMap computed by encoder.</p></li>
<li><p><strong>targets</strong> – a NestedMap containing target info.</p></li>
<li><p><strong>seq_out_tas</strong> – a SequenceOutTensorArrays.</p></li>
<li><p><strong>softmax_input</strong> – a tensor of shape [batch, time, vocab_size].</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder._ComputeAttention">
<code class="sig-name descname"><span class="pre">_ComputeAttention</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rnn_out</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">packed_src</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attention_state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">per_step_src_padding</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query_segment_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder._ComputeAttention"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder._ComputeAttention" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs attention and computes context vector.</p>
<p>Can be overridden by a child class if attention is computed differently.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> – A NestedMap object containing weights for the attention layers.
Expects a member named ‘atten’.</p></li>
<li><p><strong>rnn_out</strong> – A Tensor of shape [batch_size, query_dim]; output of the first
layer of decoder RNN, which is the query vector used for attention.</p></li>
<li><p><strong>packed_src</strong> – A NestedMap returned by self.atten.InitForSourcePacked.</p></li>
<li><p><strong>attention_state</strong> – The attention state computed at the previous timestep.
Varies with the type of attention, but is usually a Tensor or a
NestedMap of Tensors of shape [batch_size, &lt;state_dim&gt;].</p></li>
<li><p><strong>per_step_src_padding</strong> – Source sequence padding to apply at this step.</p></li>
<li><p><strong>query_segment_id</strong> – a tensor of shape [batch_size].</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p>The attention context vector: shaped [batch_size, context_dim].</p></li>
<li><p>The attention probability vector: shaped [batch_size, seq_len]</p></li>
<li><p>The attention state: A Tensor or a NestedMap of Tensors of shape
[batch_size, &lt;state_dim&gt;].</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>A tuple of 3 tensors</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder.SingleDecodeStep">
<code class="sig-name descname"><span class="pre">SingleDecodeStep</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">packed_src</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cur_target_info</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decoder_step_state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">per_step_src_padding</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_deterministic_random</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder.SingleDecodeStep"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder.SingleDecodeStep" title="Permalink to this definition">¶</a></dt>
<dd><p>Decode one step.</p>
<p>Note that the implementation of attention here follows the model in
<a class="reference external" href="https://arxiv.org/pdf/1609.08144.pdf">https://arxiv.org/pdf/1609.08144.pdf</a>, detailed more in
<a class="reference external" href="https://arxiv.org/pdf/1703.08581.pdf">https://arxiv.org/pdf/1703.08581.pdf</a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> – A NestedMap object containing weights’ values of this layer and its
children layers.</p></li>
<li><p><strong>packed_src</strong> – A NestedMap to represent the packed source tensors generated
by the attention model.</p></li>
<li><p><strong>cur_target_info</strong> – TargetInfo namedtuple, which represents the targets which
represents information about the target at this step. It is up to the
various sub-classes to determine how to process the current target.</p></li>
<li><p><strong>decoder_step_state</strong> – DecoderStepState which encapsulates the state of the
decoder before computing outputs at the current step.</p></li>
<li><p><strong>per_step_src_padding</strong> – Optional padding to be applied to the source_encs
which overrides the default padding in source_paddings. Used, for
example, by the Neural Transducer (NT) decoder.</p></li>
<li><p><strong>use_deterministic_random</strong> – whether to use deterministic random numbers when
needed. Must be set to True if called from functional recurrent.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tuple (step_out, new_decoder_state) which represent the outputs of the
decoder (usually logits), and the new decoder state after processing the
current step.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder._GetNumHypsForBeamSearch">
<code class="sig-name descname"><span class="pre">_GetNumHypsForBeamSearch</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source_encs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_hyps_per_beam</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder._GetNumHypsForBeamSearch"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder._GetNumHypsForBeamSearch" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns number of hypothesis times batch_size.</p>
<p>This function can be overridden by a child class if the total number of
hyps are to be computed in a different way, e.g., when the format of inputs
change.
:param source_encs: A Tensor of [time, batch, dim] with source encodings.
:param num_hyps_per_beam: Int, the number of hypothesis per example in the beam.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A Tensor with value batch * num_hyps_per_beam.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder._PostProcessAttenProbsForBeamSearch">
<code class="sig-name descname"><span class="pre">_PostProcessAttenProbsForBeamSearch</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">atten_probs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder._PostProcessAttenProbsForBeamSearch"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder._PostProcessAttenProbsForBeamSearch" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the attention probabilities after optional post processing.</p>
<p>This is a noop for the base class. But this function can be overridden
by a child class, e.g., when the format of probabilities change.
:param atten_probs: A Tensor of [batch, source_len] dimension with atten probs.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A Tensor with processed atten_probs. The same as input in this case.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder._InitBeamSearchStateCallback">
<code class="sig-name descname"><span class="pre">_InitBeamSearchStateCallback</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">encoder_outputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_hyps_per_beam</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder._InitBeamSearchStateCallback"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder._InitBeamSearchStateCallback" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder._PreBeamSearchStepCallback">
<code class="sig-name descname"><span class="pre">_PreBeamSearchStepCallback</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">encoder_outputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step_ids</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">states</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_hyps_per_beam</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder._PreBeamSearchStepCallback"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder._PreBeamSearchStepCallback" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder._PostBeamSearchStepCallback">
<code class="sig-name descname"><span class="pre">_PostBeamSearchStepCallback</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">theta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">encoder_outputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_step_ids</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">states</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder._PostBeamSearchStepCallback"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder._PostBeamSearchStepCallback" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="lingvo.tasks.asr.decoder_metrics.html" class="btn btn-neutral float-right" title="lingvo.tasks.asr.decoder_metrics module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="lingvo.tasks.asr.contextualizer_base.html" class="btn btn-neutral float-left" title="lingvo.tasks.asr.contextualizer_base module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2018.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>